# vib
base: ghcr.io/vanilla-os/nvidia:main
name: Personal Vanilla+ Nvidia Desktop
id: vanillaplus-os
labels:
  maintainer: Jakub Kujawa <ZK_Jakub@proton.me>
args:
  DEBIAN_FRONTEND: noninteractive

modules:
- name: init-setup
  type: shell
  commands:
  - lpkg --unlock
  - apt-get update

- name: package-modules
  type: includes
  includes:
    - modules/49-download-debs
    - modules/50-install-debs
    - modules/60-install-packages
    - modules/70-remove-packages

- name: printer-drivers
  type: shell
  commands:
    - wget https://support.brother.com/g/b/files/dlf/dlf007072/hl1110lpr-3.0.1-1.i386.deb -O /sources/hl1110lpr-3.0.1-1.i386.deb
    - wget https://support.brother.com/g/b/files/dlf/dlf007074/hl1110cupswrapper-3.0.1-1.i386.deb -O /sources/hl1110cupswrapper-3.0.1-1.i386.deb
    - dpkg -i --force-all /sources/hl1110lpr-3.0.1-1.i386.deb
    - dpkg -i --force-all /sources/hl1110cupswrapper-3.0.1-1.i386.deb
    - apt -y install -f

- name: set-image-name-abroot
  type: includes
  includes:
    - modules/80-set-image-abroot-config

- name: cleanup
  type: shell
  commands:
    - apt-get autoremove -y
    - apt-get clean
    - lpkg --lock

- name: fsguard
  type: fsguard
  CustomFsGuard: false
  FsGuardLocation: "/usr/sbin/FsGuard"
  GenerateKey: true
  FilelistPaths: ["/usr/bin"]
  modules:
    - name: remove-prev-fsguard
      type: shell
      commands:
        - rm -rf /FsGuard 
        - rm -f ./minisign.pub ./minisign.key 
        - chmod +x /usr/sbin/init

- name: cleanup-two
  type: shell
  commands:
    - rm -rf /tmp/*
    - rm -rf /var/tmp/*
    - rm -rf /sources
